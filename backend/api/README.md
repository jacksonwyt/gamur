# GAMUR Backend API

This is the backend API for the GAMUR application, built with NestJS, Prisma, and PostgreSQL.

## Table of Contents

- [Technology Stack](#technology-stack)
- [Project Structure](#project-structure)
- [Prerequisites](#prerequisites)
- [Setup and Installation](#setup-and-installation)
- [Running the Application](#running-the-application)
- [API Documentation](#api-documentation)
- [Database Migrations](#database-migrations)
- [Running Tests](#running-tests)

## Technology Stack

*   **Framework:** [NestJS](https://nestjs.com/) (Node.js)
*   **Language:** TypeScript
*   **ORM:** [Prisma](https://www.prisma.io/)
*   **Database:** PostgreSQL
*   **Containerization (for Database):** [Docker](https://www.docker.com/)
*   **API Documentation:** Swagger (OpenAPI)

## Project Structure

Key directories within `backend/api/`:

*   `src/`: Contains the application source code (modules, controllers, services, DTOs, etc.).
*   `prisma/`: Contains Prisma schema (`schema.prisma`) and migration files.
    *   `migrations/`: Stores the SQL migration files generated by Prisma.
*   `test/`: Contains test files (unit, integration, E2E).
*   `dist/`: Contains the compiled JavaScript code (generated during build, usually not committed).
*   `generated/`: Contains the generated Prisma client (usually not committed).

## Prerequisites

*   [Node.js](https://nodejs.org/) (LTS version recommended)
*   `npm` (comes with Node.js) or `yarn`
*   [Docker Desktop](https://www.docker.com/products/docker-desktop) (for running the PostgreSQL database)
*   Access to a running PostgreSQL instance (either via Docker or a separate installation).

## Setup and Installation

1.  **Clone the Repository:** (If you haven't already)
    ```bash
    git clone <repository-url>
    cd gamur/backend/api
    ```

2.  **Install Dependencies:**
    ```bash
    npm install
    ```

3.  **Environment Variables:**
    This project requires environment variables for configuration. Create a `.env` file in the `backend/api/` directory by copying the example file:
    ```bash
    cp .env.example .env
    ```
    Then, update the `.env` file with your specific configurations. Key variables include:
    *   `DATABASE_URL`: Connection string for your PostgreSQL database.
        *   Example: `postgresql://user:password@localhost:5432/mydatabase?schema=public`
    *   `JWT_ACCESS_SECRET`: Secret key for signing JWT access tokens.
    *   `JWT_ACCESS_EXPIRATION_TIME`: Expiration time for access tokens (e.g., `15m`).
    *   `JWT_REFRESH_SECRET`: Secret key for signing JWT refresh tokens.
    *   `JWT_REFRESH_EXPIRATION_TIME`: Expiration time for refresh tokens (e.g., `7d`).
    *   `PORT` (Optional): Port for the API to run on (defaults to 3000).

4.  **Database Setup (PostgreSQL with Docker - Recommended for local development):**
    If you don't have a PostgreSQL instance running, you can use Docker. A `docker-compose.yml` is recommended for managing this alongside the application, but if you don't have one yet, you can run PostgreSQL standalone:
    ```bash
    docker run --name gamur-postgres -e POSTGRES_USER=youruser -e POSTGRES_PASSWORD=yourpassword -e POSTGRES_DB=gamurdb -p 5432:5432 -d postgres
    ```
    Replace `youruser`, `yourpassword`, and `gamurdb` with your desired credentials and database name. Ensure your `DATABASE_URL` in the `.env` file matches these.

5.  **Prisma Setup:**
    *   **Generate Prisma Client:** The Prisma client is usually generated automatically due to the `prepare` script in `package.json` (`"prepare": "prisma generate"`). If not, you can run it manually:
        ```bash
        npx prisma generate
        ```
    *   **Run Database Migrations:** Apply any pending database migrations to set up your schema:
        ```bash
        npx prisma migrate dev
        ```
        This will create the database if it doesn't exist (based on your `DATABASE_URL`) and apply all migrations.

## Running the Application

Once setup is complete:

*   **Development Mode (with watch and auto-reload):**
    ```bash
    npm run start:dev
    ```
    The API will typically be available at `http://localhost:3000` (or the port specified in your `.env`).

*   **Production Mode:**
    First, build the application:
    ```bash
    npm run build
    ```
    Then, start the application:
    ```bash
    npm run start
    ```

## API Documentation

This API uses Swagger for documentation. Once the application is running, you can access the Swagger UI at:
[http://localhost:3000/api](http://localhost:3000/api) (or your configured host/port + `/api`)

## Database Migrations (Prisma)

Prisma is used to manage database schema migrations.

*   **To create a new migration after schema changes (`prisma/schema.prisma`):**
    ```bash
    npx prisma migrate dev --name your-migration-name
    ```
    Replace `your-migration-name` with a descriptive name for your migration (e.g., `add-user-table`).

*   **To apply pending migrations (as done in setup):**
    ```bash
    npx prisma migrate dev
    ```

*   **To see migration status:**
    ```bash
    npx prisma migrate status
    ```

## Running Tests

*   **Run all unit and integration tests:**
    ```bash
    npm test
    ```

*   **Run End-to-End (E2E) tests (if configured):**
    ```bash
    npm run test:e2e
    ```

*   **Generate test coverage report:**
    ```bash
    npm run test:cov
    ```

---

*This README provides guidance for setting up and running the GAMUR backend API. Please refer to the root [README.md](../../README.md) for overall project information.*
